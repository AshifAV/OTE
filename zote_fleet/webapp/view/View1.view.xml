<mvc:View
    controllerName="zotefleet.controller.View1"
    xmlns="sap.m"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:layout="sap.ui.layout"
    xmlns:f="sap.ui.layout.form"
    xmlns:core="sap.ui.core"
    displayBlock="true">

    <App>
        <pages>
            <Page
                title="Fleet Management - Update Registration"
                showNavButton="false"
                class="sapUiNoContentPadding">

                <content>
                    <VBox class="sapUiResponsiveContentPadding sapUiMediumMargin">

                        <Panel
                            headerText="Vehicle Registration Update"
                            expandable="false"
                            class="modern-panel">

                            <content>
                                <VBox class="sapUiSmallMargin">

                                    <!-- Search fields + contacts under Customer -->
                                    <f:SimpleForm
                                        id="idSearchForm"
                                        editable="true"
                                        layout="ResponsiveGridLayout"
                                        labelSpanXL="3"
                                        labelSpanL="3"
                                        labelSpanM="4"
                                        labelSpanS="12"
                                        emptySpanXL="0"
                                        emptySpanL="0"
                                        emptySpanM="0"
                                        emptySpanS="0"
                                        columnsXL="3"
                                        columnsL="3"
                                        columnsM="2"
                                        columnsS="1"
                                        class="sapUiSmallMarginBottom">

                                        <f:content>

                                            <!-- Customer + Contacts below it -->
                                            <Label text="Customer" design="Bold" />
                                            <VBox>
                                                <HBox alignItems="Center">
                                                    <Input
                                                        id="idCustomer"
                                                        valueHelpOnly="true"
                                                        showValueHelp="true"
                                                        width="100%"
                                                        placeholder="Select customer"
                                                        valueHelpRequest=".onCustomerValueHelp"
                                                        change=".onCustomerChange"/>
                                                    <core:Icon
                                                        src="sap-icon://value-help"
                                                        size="1.25rem"
                                                        color="#0a6ed1"
                                                        class="sapUiTinyMarginBegin"/>
                                                </HBox>
                                                <Text
                                                    id="idCustomerName"
                                                    text="No customer selected"
                                                    wrapping="true"
                                                    class="sapUiTinyMarginTop"/>

                                                <!-- Contacts â€“ visibility controlled by binding only -->
                                                <VBox id="idCustomerContacts"
                                                      visible="false"
                                                      class="sapUiMediumMarginTop sapUiSmallMarginBegin">
                                                    <Label text="Emails:" design="Bold" class="sapUiTinyMarginBottom"/>
                                                    <HBox id="idEmailsContainer" wrap="Wrap" class="sapUiSmallMarginBottom"/>

                                                    <Label text="Telephones:" design="Bold" class="sapUiTinyMarginTop sapUiTinyMarginBottom"/>
                                                    <HBox id="idPhonesContainer" wrap="Wrap" class="phone-container sapUiSmallMarginBottom"/>

                                                    <HBox justifyContent="Start" alignItems="Center" class="sapUiTinyMarginTop">
                                                        <Button
                                                            text="Add Mobile"
                                                            icon="sap-icon://add-contact"
                                                            type="Transparent"
                                                            press=".onAddMobileNumber"/>
                                                        <Button
                                                            text="Add Email"
                                                            icon="sap-icon://email"
                                                            type="Transparent"
                                                            press=".onAddEmail"
                                                            class="sapUiTinyMarginBegin"/>
                                                    </HBox>
                                                </VBox>
                                            </VBox>

                                            <!-- Equipment -->
                                            <Label text="Equipment" design="Bold" />
                                            <VBox>
                                                <HBox alignItems="Center">
                                                    <Input
                                                        id="idEquipment"
                                                        valueHelpOnly="true"
                                                        showValueHelp="true"
                                                        width="100%"
                                                        placeholder="Select equipment"
                                                        valueHelpRequest=".onEquipmentValueHelp"
                                                        change=".onEquipmentChange"/>
                                                    <core:Icon
                                                        src="sap-icon://value-help"
                                                        size="1.25rem"
                                                        color="#0a6ed1"
                                                        class="sapUiTinyMarginBegin"/>
                                                </HBox>
                                                <Text
                                                    id="idEquipmentDescription"
                                                    text="No equipment selected"
                                                    wrapping="true"
                                                    class="sapUiTinyMarginTop"/>
                                            </VBox>

                                            <!-- VIN/Chassis -->
                                            <Label text="VIN/Chassis Number" design="Bold" />
                                            <VBox>
                                                <HBox alignItems="Center">
                                                    <Input
                                                        id="idVINSearch"
                                                        valueHelpOnly="true"
                                                        showValueHelp="true"
                                                        width="100%"
                                                        placeholder="Search by VIN"
                                                        valueHelpRequest=".onVINValueHelp"
                                                        change=".onVINChange"/>
                                                    <core:Icon
                                                        src="sap-icon://value-help"
                                                        size="1.25rem"
                                                        color="#0a6ed1"
                                                        class="sapUiTinyMarginBegin"/>
                                                </HBox>
                                                <Text
                                                    id="idVINDescription"
                                                    text="Search by VIN/Chassis number"
                                                    wrapping="true"
                                                    class="sapUiTinyMarginTop"/>
                                            </VBox>

                                            <!-- Action Buttons -->
                                            <Label text="" />
                                            <VBox alignItems="Start">
                                                <Button
                                                    text="Clear Filters"
                                                    press=".onClearFiltersPress"
                                                    icon="sap-icon://clear-filter"
                                                    width="140px"
                                                    class="sapUiTinyMarginBottom"/>
                                                <Button
                                                    text="Refresh"
                                                    press=".onRefreshPress"
                                                    icon="sap-icon://refresh"
                                                    width="140px"/>
                                            </VBox>

                                        </f:content>
                                    </f:SimpleForm>

                                    <!-- Main Table -->
                                    <Table
                                        id="idEquipmentTable"
                                        width="100%"
                                        mode="SingleSelectMaster"
                                        selectionChange=".onTableItemPress"
                                        growing="true"
                                        growingThreshold="20"
                                        items="{ path: 'table>/equipmentItems', sorter: { path: 'equnr', descending: false } }"
                                        class="equipment-table">

                                        <headerToolbar>
                                            <OverflowToolbar>
                                                <Title text="Vehicle Details" level="H2"/>
                                                <ToolbarSpacer/>
                                                <Label text="Search Mode:" class="sapUiTinyMarginEnd"/>
                                                <Select id="idSearchMode" selectedKey="customer" change=".onSearchModeChange" width="140px">
                                                    <core:Item key="customer" text="Customer"/>
                                                    <core:Item key="equipment" text="Equipment"/>
                                                    <core:Item key="vin" text="VIN"/>
                                                </Select>
                                                <Label text="Plate Type:" class="sapUiTinyMarginEnd sapUiTinyMarginBegin"/>
                                                <RadioButtonGroup id="idPlateType" columns="2" selectedIndex="0" select=".onPlateTypeChange" class="sapUiTinyMarginEnd">
                                                    <RadioButton text="Registered"/>
                                                    <RadioButton text="Test Drive / Courtesy "/>
                                                </RadioButtonGroup>
                                                <Button id="idUpdateButton" text="Update Selected" press=".onUpdateSelectedPress" type="Accept" icon="sap-icon://save" enabled="false" class="sapUiTinyMarginBegin"/>
                                                <Text text="{= ${table>/equipmentItems}.length || 0 } item(s)" class="sapUiTinyMarginBegin"/>
                                            </OverflowToolbar>
                                        </headerToolbar>

                                        <columns>
                                            <Column minWidth="8rem" demandPopin="true" popinDisplay="Inline"><Text text="Equipment"/></Column>
                                            <Column minWidth="12rem" demandPopin="true" popinDisplay="Inline"><Text text="Description"/></Column>
                                            <Column minWidth="10rem" demandPopin="true" popinDisplay="Inline"><Text text="Customer"/></Column>
                                            <Column minWidth="11rem" demandPopin="true" popinDisplay="Inline"><Text text="VIN/Chassis"/></Column>
                                            <Column minWidth="9rem" demandPopin="true" popinDisplay="Inline"><Text text="Original Plate"/></Column>
                                            <Column minWidth="8rem" demandPopin="true" popinDisplay="Inline" visible="{= ${form>/plateType} === 'green' }"><Text text="Plate Numbers"/></Column>
                                            <Column minWidth="7rem" demandPopin="true" popinDisplay="Inline" visible="{= ${form>/plateType} === 'green' }"><Text text="Plate Letters"/></Column>
                                            <Column minWidth="12rem" demandPopin="true" popinDisplay="Inline" visible="{= ${form>/plateType} === 'registered' }"><Text text="Registered Plate"/></Column>
                                        </columns>

                                        <items>
                                            <ColumnListItem type="Active">
                                                <cells>
                                                    <Text text="{ path: 'table>equnr', formatter: '.formatEquipmentNoLeadingZeros' }" wrapping="true"/>
                                                    <Text text="{table>eqktx}" wrapping="true"/>
                                                    <Text text="{table>name1}" wrapping="true"/>
                                                    <Text text="{table>fleetVin}" wrapping="true"/>
                                                    <Text text="{table>originalLicenseNum}" wrapping="true"/>
                                                    <Input value="{table>licenseNumNumeric}" change=".onPlateNumericChange" liveChange=".onPlateNumericLiveChange" placeholder="e.g. 1234 or 12-34" width="100%" editable="{table>editable}" visible="{= ${form>/plateType} === 'green' }"/>
                                                    <Input value="{table>licenseNumAlphabet}" change=".onPlateAlphabetChange" liveChange=".onPlateAlphabetLiveChange" placeholder="e.g. ABC" width="100%" maxLength="3" editable="{table>editable}" visible="{= ${form>/plateType} === 'green' }"/>
                                                    <Input value="{table>registeredLicenseNum}" change=".onRegisteredPlateChange" liveChange=".onRegisteredPlateLiveChange" placeholder="Enter plate number" width="100%" editable="{table>editable}" visible="{= ${form>/plateType} === 'registered' }"/>
                                                </cells>
                                            </ColumnListItem>
                                        </items>

                                        <noData>
                                            <IllustratedMessage title="No Vehicles Found" description="Select a search criteria to view details" illustrationType="sapIllus-EmptyList">
                                                <additionalContent>
                                                    <Button text="Select Customer" press=".onSelectCustomerHelp" icon="sap-icon://customer" class="sapUiTinyMarginEnd"/>
                                                    <Button text="Select Equipment" press=".onSelectEquipmentHelp" icon="sap-icon://machine" class="sapUiTinyMarginEnd"/>
                                                    <Button text="Search by VIN" press=".onSelectVINHelp" icon="sap-icon://search"/>
                                                </additionalContent>
                                            </IllustratedMessage>
                                        </noData>
                                    </Table>

                                    <!-- Status + Batch Actions -->
                                    <HBox justifyContent="SpaceBetween" alignItems="Center" wrap="Wrap" class="sapUiMediumMarginTop">
                                        <VBox width="100%" class="sapUiSmallMarginBottom">
                                            <MessageStrip id="idStatusMessage" type="Information" showIcon="true" showCloseButton="true" visible="false" class="status-message"/>
                                        </VBox>
                                        <HBox justifyContent="End" wrap="Wrap">
                                            <Button id="idBatchUpdateButton" text="Update All Changes" press=".onBatchUpdatePress" type="Emphasized" icon="sap-icon://save" enabled="false" class="sapUiTinyMarginEnd"/>
                                            <Button text="Clear All" press=".onClearAllPress" icon="sap-icon://delete"/>
                                        </HBox>
                                    </HBox>

                                </VBox>
                            </content>
                        </Panel>
                    </VBox>
                </content>
            </Page>
        </pages>
    </App>
</mvc:View>